class ImageLibrary{constructor(e={}){this.config={imageFormId:e.imageFormId||"imageUploadForm",imageFileInputId:e.imageFileInputId||"imageFileInput",imageFileInputName:e.imageFileInputName||"imageFileInput",imageAltTextInputId:e.imageAltTextInputId||"imageAltText",imageAltTextInputName:e.imageAltTextInputName||"imageAltText",imageHiddenInputId:e.imageHiddenInputId||"library_image_button",imageHiddenInputName:e.imageHiddenInputName||"library_image_button",imageSubmitButtonId:e.imageSubmitButtonId||"uploadImageButton",imageMessageFieldId:e.imageMessageFieldId||"imageUploadMessage",imageSearchInputId:e.imageSearchInputId||"imageSearch",imageSearchInputName:e.imageSearchInputName||"imageSearch",imagesListContainerId:e.imagesListContainerId||"imageList",imagesLibraryContainerId:e.imagesLibraryContainerId||"imageLibrary",libraryToggleButtonId:e.libraryToggleButtonId||"toggleImageLibrary",maxFiles:e.maxFiles||20,maxFileSize:e.maxFileSize||100,allowedExtensions:e.allowedExtensions||["jpg","jpeg","png","webp"],checks:e.checks||{maxFileSizeCheck:!0,maxFilesCheck:!0,allowedExtensionsCheck:!0},onRemoveImage:e.onRemoveImage||this.defaultRemoveImage,onSearchImages:e.onSearchImages||this.defaultSearchImages,onChangeImages:e.onChangeImages||this.defaultChangeImages,onSubmitImages:e.onSubmitImages||this.defaultSubmitImages,onLoadLibraryImages:e.onLoadLibraryImages||this.defaultLoadLibraryImages},this.init_image_library(),this.init_library_floating_button(),this.eventListeners()}init_image_library=()=>{const e=document.createElement("div");e.style.cssText="\n            background-color: #fff;\n            border-radius: .5rem;\n            box-shadow: 0 .375rem 1.5rem 0 rgba(140, 152, 164, .125);\n            position: sticky;\n            top: 1rem;\n            padding: 0 1.5rem;\n            width: 100%;\n            height: 100%;\n            overflow-y: scroll\n        ";const t=document.createElement("div");t.style.cssText="\n            position: sticky;\n            top: 0;\n            z-index: 2;\n            background: white;\n            padding: 1rem 0;\n        ";const i=document.createElement("div");i.style.cssText="\n            padding-bottom: 1.5rem;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        ";const n=document.createElement("h4");n.textContent="Images Library",n.style.cssText="\n            text-align: center;\n            margin-bottom: 0;\n        ",i.appendChild(n);const o=document.createElement("span");o.textContent="x",o.style.cssText="\n            background-color: red;\n            color: white;\n            border-radius: 50%;\n            padding: 2px 10px;\n            cursor: pointer; \n        ",o.addEventListener("click",(e=>{document.getElementById(`${this.config.imagesLibraryContainerId}`).style.display="none",document.getElementById(`${this.config.libraryToggleButtonId}`).style.display="block"})),i.append(o),t.append(i);const s=document.createElement("form");s.action="",s.id=this.config.imageFormId;const a=document.createElement("div");a.style.cssText="\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0rem;\n            border: 1px solid rgb(221, 221, 221);\n            border-radius: .35rem;\n        ";const r=document.createElement("input");r.type="file",r.name=`${this.config.imageFileInputName}[]`,r.accept=".jpg, .jpeg, .png, .webp",r.multiple=!0,r.required=!0,r.id=this.config.imageFileInputId,r.style.cssText="\n            width: 100%;\n            padding-left: 5px;\n            cursor: pointer;\n            min-width: 100px;\n        ",a.appendChild(r);const l=document.createElement("input");l.type="text",l.name=this.config.imageAltTextInputName,l.id=this.config.imageAltTextInputId,l.required=!0,l.placeholder="Searchable Text",l.style.cssText="\n            border-radius: 0px; \n            border: 1px solid rgb(221, 221, 221); \n            border-width: 0 1px; \n            padding: 7.5px 5px; \n            width:100%\n        ",a.appendChild(l);const d=document.createElement("input");d.type="hidden",d.name=this.config.imageHiddenInputName,d.id=this.config.imageHiddenInputId,a.appendChild(d);const c=document.createElement("button");c.type="submit",c.id=this.config.imageSubmitButtonId,c.style.cssText="\n            font-size: 14px;\n            padding: 0.5rem 1rem;\n            background-color: #007bff;\n            color: #fff;\n            border: none;\n            border-radius: 0 .25rem .25rem 0;\n            cursor: pointer;\n        ";const g=document.createElement("span");g.textContent="Upload",c.append(g);const m=document.createElement("span");m.style.cssText="\n            display: none;\n            width: 1rem;\n            height: 1rem;\n            border: 2px solid #f3f3f3;\n            border-top: 2px solid #333;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        ",c.appendChild(m),a.appendChild(c),s.appendChild(a);const p=document.createElement("span");p.id=this.config.imageMessageFieldId,p.style.cssText="font-size: 14px;",s.appendChild(p),t.appendChild(s);const h=document.createElement("input");h.type="text",h.name=this.config.imageSearchInputName,h.id=this.config.imageSearchInputId,h.required=!0,h.placeholder="Search Image",h.style.cssText="\n            border-radius: 5px; \n            border: 1px solid rgb(221, 221, 221); \n            padding: 7px 10px; \n            margin-top: 10px;\n            width: 100%\n        ",t.appendChild(h);const u=document.createElement("div");u.id=this.config.imagesListContainerId,u.style.cssText="\n            margin-top: 1rem;\n            padding-top: 1rem;\n            border-top: 1px solid #ddd;\n            display: flex;\n            flex-wrap: wrap;\n            gap: 0.5rem;\n            justify-content: start;\n            align-items: center;\n        ",e.appendChild(t),e.appendChild(u);let y=this.libraryGetCookie("libraryContainerPosition");if(""!=y)try{y=JSON.parse(y)||{};const e=parsePixel(y.top),t=parsePixel(y.left),i=parsePixel(y.right),n=parsePixel(y.bottom),o=parseInt(this.libraryGetCookie("libraryContainerResize")?.width||"350"),s=parseInt(this.libraryGetCookie("libraryContainerResize")?.height||"600");(null!==e&&(e+s>window.innerHeight||e<0)||null!==t&&(t+o>window.innerWidth||t<0)||null!==i&&i<0||null!==n&&n<0)&&(y={})}catch(e){y={}}let b=this.libraryGetCookie("libraryContainerResize");if(""!=b)try{b=JSON.parse(b)||{};const e=parseInt(b.width||0),t=parseInt(b.height||0);(e<=0||t<=0||e>window.innerWidth||t>window.innerHeight)&&(b={})}catch(e){b={}}const f=document.createElement("div");f.id=this.config.imagesLibraryContainerId,f.style.cssText=`\n            display: none;\n            border-radius: 10px;\n            z-index: 1001;\n            position: fixed;\n            top: ${y?.top??"5px"};\n            right: ${y?.right??"5px"};\n            bottom: ${y?.bottom??"auto"};\n            left: ${y?.left??"auto"};\n            width: ${b?.width??"350px"};\n            height: ${b?.height??"90vh"};\n        `,f.appendChild(e),document.body.appendChild(f);const x=document.createElement("style");x.textContent="\n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n        ",document.head.appendChild(x),this.dragNDrop(f,"libraryContainerPosition"),this.resizeContainer(f,"libraryContainerResize")};librarySetCookie(e,t,i){const n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);let o="expires="+n.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}libraryGetCookie(e){let t=e+"=",i=decodeURIComponent(document.cookie).split(";");for(let e=0;e<i.length;e++){let n=i[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}dragNDrop(e,t){let i,n,o=!1;e.addEventListener("mousedown",(t=>{["IMG","INPUT"].includes(t.target.tagName)||["resize-handle"].some((e=>t.target.classList.contains(e)))||e.isResizing||(o=!0,i=t.clientX-e.offsetLeft,n=t.clientY-e.offsetTop,e.style.cursor="grabbing")})),document.addEventListener("mousemove",(s=>{if(o&&!e.isResizing){const o=s.clientX-i,a=s.clientY-n;e.style.left=`${o}px`,e.style.top=`${a}px`,e.style.right="auto",e.style.bottom="auto",this.librarySetCookie(t,JSON.stringify({left:`${o}px`,top:`${a}px`,right:"auto",bottom:"auto"}),365)}})),document.addEventListener("mouseup",(()=>{o&&(o=!1,e.style.cursor="grab")}))}resizeContainer(e,t){let i=!1;["top","bottom","left","right"].forEach((n=>{const o=document.createElement("div");switch(o.className=`resize-handle ${n}`,o.style.cssText="\n                position: absolute;\n                background-color: #007bff;\n                z-index: 10;\n            ",n){case"top":Object.assign(o.style,{top:"0",left:"0",right:"0",height:"3px",borderRadius:"10px",cursor:"n-resize"});break;case"bottom":Object.assign(o.style,{bottom:"0",left:"0",right:"0",height:"3px",borderRadius:"10px",cursor:"s-resize"});break;case"left":Object.assign(o.style,{top:"0",bottom:"0",left:"0",width:"3px",borderRadius:"10px",cursor:"w-resize"});break;case"right":Object.assign(o.style,{top:"0",bottom:"0",right:"0",width:"3px",borderRadius:"10px",cursor:"e-resize"});break;case"top-left":Object.assign(o.style,{top:"0",left:"0",width:"10px",height:"10px",cursor:"nw-resize"});break;case"top-right":Object.assign(o.style,{top:"0",right:"0",width:"10px",height:"10px",cursor:"ne-resize"});break;case"bottom-left":Object.assign(o.style,{bottom:"0",left:"0",width:"10px",height:"10px",cursor:"sw-resize"});break;case"bottom-right":Object.assign(o.style,{bottom:"0",right:"0",width:"10px",height:"10px",cursor:"se-resize"})}e.appendChild(o),o.addEventListener("mousedown",(t=>{e.isDragging||(t.preventDefault(),i=n,document.body.style.cursor=o.style.cursor)})),document.addEventListener("mousemove",(n=>{if(i&&!e.isDragging){const o=e.getBoundingClientRect();switch(i){case"top":const t=o.bottom-n.clientY;t>=100&&(e.style.height=`${t}px`,e.style.top=`${n.clientY}px`);break;case"bottom":const i=n.clientY-o.top;e.style.height=`${Math.max(i,100)}px`;break;case"left":const s=o.right-n.clientX;s>=150&&(e.style.width=`${s}px`,e.style.left=`${n.clientX}px`);break;case"right":const a=n.clientX-o.left;e.style.width=`${Math.max(a,150)}px`;break;case"top-left":const r=o.bottom-n.clientY,l=o.right-n.clientX;r>=100&&(e.style.height=`${r}px`,e.style.top=`${n.clientY}px`),l>=150&&(e.style.width=`${l}px`,e.style.left=`${n.clientX}px`);break;case"top-right":const d=o.bottom-n.clientY,c=n.clientX-o.left;d>=100&&(e.style.height=`${d}px`,e.style.top=`${n.clientY}px`),e.style.width=`${Math.max(c,150)}px`;break;case"bottom-left":const g=n.clientY-o.top,m=o.right-n.clientX;e.style.height=`${Math.max(g,100)}px`,m>=150&&(e.style.width=`${m}px`,e.style.left=`${n.clientX}px`);break;case"bottom-right":const p=n.clientY-o.top,h=n.clientX-o.left;e.style.height=`${Math.max(p,100)}px`,e.style.width=`${Math.max(h,150)}px`}const s={width:e.style.width,height:e.style.height};this.librarySetCookie(t,JSON.stringify(s),365),this.librarySetCookie("libraryContainerPosition",JSON.stringify({left:`${e.style.left}`,top:`${e.style.top}`,right:"auto",bottom:"auto"}),365)}})),document.addEventListener("mouseup",(()=>{i&&(i=!1,document.body.style.cursor="default")}))}))}parsePixel=e=>"string"==typeof e&&e.endsWith("px")?parseInt(e):null;init_library_floating_button=()=>{const e=document.createElement("button");e.innerText="+",e.id=this.config.libraryToggleButtonId;let t=this.libraryGetCookie("libraryFloatingButtonPosition");if(""!=t)try{t=JSON.parse(t)||{};const e=parsePixel(t.top),i=parsePixel(t.right),n=parsePixel(t.bottom),o=parsePixel(t.left),s=60;(null!==e&&(e+60>window.innerHeight||e<0)||null!==o&&(o+s>window.innerWidth||o<0)||null!==i&&i<0||null!==n&&n<0)&&(t={})}catch(e){t={}}const i=`\n            position: fixed;\n            top: ${t?.top??"100px"};\n            right: ${t?.right??"50px"};\n            bottom: ${t?.bottom??"auto"};\n            left: ${t?.left??"auto"};\n            width: 60px;\n            height: 60px;\n            background-color: #007bff;\n            color: white;\n            border: none;\n            border-radius: 50%;\n            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            font-size: 24px;\n            cursor: pointer;\n            z-index: 1000;\n            transition: background-color 0.3s ease;\n        `;e.style.cssText=i,this.dragNDrop(e,"libraryFloatingButtonPosition"),e.addEventListener("mouseenter",(()=>{e.style.backgroundColor="#0056b3"})),e.addEventListener("mouseleave",(()=>{e.style.backgroundColor="#007bff"})),document.body.appendChild(e),e.addEventListener("dblclick",(()=>{document.getElementById(`${this.config.imagesLibraryContainerId}`).style.display="block",document.getElementById(`${this.config.libraryToggleButtonId}`).style.display="none"}))};createImageElement(e){const t=document.createElement("div");t.innerHTML='<span class="remove_image_target">x</span>',t.style.cssText="background: red; border-radius: 50%; font-size: 12px; padding: 0px 5px; color: white; position: absolute; top: -5px; right: -5px; cursor: pointer;",t.setAttribute("data-id",e.id);const i=document.createElement("img");i.src=`${e.img}`,i.alt=`${e?.alt_text??""}`,i.loading="lazy",i.width="78px",i.height="78px",i.style.cssText="width: 100%; height: 100%; object-fit: cover; cursor: pointer;",i.classList.add("image_target");const n=document.createElement("input");n.type="hidden",n.value=`${e.img}`,n.style.cssText="display: none;";const o=document.createElement("div");return o.style.cssText="position: relative; margin: 5px; width: 80px; height: 80px; border: 1px solid;",o.appendChild(i),o.appendChild(t),o.appendChild(n),o}defaultLoadLibraryImages=e=>{try{const t=document.getElementById(`${this.config.imagesListContainerId}`);t.innerHTML="";const i=document.createDocumentFragment();e.forEach((e=>{const t=this.createImageElement(e);i.appendChild(t)})),t.appendChild(i)}catch(e){console.error("Error:",e)}};loadLibraryImages(e){"function"==typeof this.config.onLoadLibraryImages?this.config.onLoadLibraryImages(e,this):this.defaultLoadLibraryImages(e)}copy_text=e=>{navigator.clipboard.writeText(e).then((()=>{this.showLibraryMessage("Text copied successfully","Green")})).catch((e=>{this.showLibraryMessage("Failed to Copy text","Red")}))};showLibraryMessage(e,t){let i=document.getElementById(`${this.config.imageMessageFieldId}`);i.style.color=t,i.textContent=e,setTimeout((()=>{i.textContent=""}),3e3)}defaultSearchImages(e,t){t.forEach((t=>{const i=t.parentElement,n=t.alt.toLowerCase().includes(e.toLowerCase());i.style.display=n?"block":"none"}))}defaultRemoveImage(e){const t=document.querySelector(`[data-id="${e}"]`);t&&t.parentElement.remove()}defaultChangeImages=()=>{const e=document.querySelector(`input[type="file"][name="${this.config.imageFileInputName}[]"]`).files;if(e.length){if(this.config.checks.maxFileSizeCheck){const t=1024*this.config.maxFileSize;for(let i of e)if(i.size>t)return void this.showLibraryMessage(`File "${i.name}" exceeds the allowed size ${this.config.maxFileSize} KB.`,"red")}if(this.config.checks.maxFilesCheck&&e.length>this.config.maxFiles)this.showLibraryMessage(`You can only upload up to ${this.config.maxFiles} files at a time.`,"red");else if(this.config.checks.allowedExtensionsCheck){let t=!1;if(Array.from(e).forEach(((e,i)=>{const n=e.name.split(".").pop().toLowerCase();if(!this.config.allowedExtensions.includes(n))return t=!0,!1})),t)return this.showLibraryMessage("You are trying to upload some invalid files!","red"),!1}}};defaultSubmitImages=e=>{e.preventDefault();try{this.showLibraryMessage("Uploading...","red");const e=document.querySelector(`#${this.config.imageSubmitButtonId}`);e.setAttribute("disabled","disabled"),e.querySelector("span:first-child").style.display="none",e.querySelector("span:last-child").style.display="block"}catch(e){console.error("Error uploading images:",e)}finally{this.showLibraryMessage("The images were uploaded successfully!","green"),library_image_submit_button.querySelector("span:last-child").style.display="none",library_image_submit_button.querySelector("span:first-child").style.display="block",library_image_submit_button.removeAttribute("disabled")}};eventListeners=()=>{document.addEventListener("click",(e=>{if(e.target&&e.target.classList.contains("image_target")){const t=e.target.parentElement.querySelector("input");this.copy_text(t.value)}else if(e.target&&e.target.classList.contains("remove_image_target")){const t=e.target.parentElement.getAttribute("data-id");"function"==typeof this.config.onRemoveImage&&this.config.onRemoveImage(t,this)}}));const e=document.getElementById(`${this.config.imageSearchInputId}`);e&&e.addEventListener("keyup",(e=>{const t=e.target.value,i=document.querySelectorAll(`#${this.config.imagesListContainerId} img`);"function"==typeof this.config.onSearchImages&&this.config.onSearchImages(t,i,this)}));const t=document.getElementById(this.config.imageFormId);t&&("function"==typeof this.config.onChangeImages&&t.addEventListener("change",this.config.onChangeImages),"function"==typeof this.config.onSubmitImages&&t.addEventListener("submit",this.config.onSubmitImages))}}